Java操作Redis(Jedis客户端的使用)




## 环境

- JDK:1.7
- Redis:3.0.5
- jedis: 2.8.1

Redis 集群已经安装完成，并且能正常存储数据，如果没有安装完成请参考《Redis3.0.1集群安装步骤(包括单机)》

## jedis客户端的简单使用


添加jedis客户端jar包

```xml
<dependency>
	<groupId>redis.clients</groupId>
	<artifactId>jedis</artifactId>
	<version>2.8.1</version>
</dependency>
```


```Java
package me.lingfeng.test;

import java.util.HashSet;
import java.util.List;
import java.util.Set;

import org.junit.Test;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.data.redis.core.RedisTemplate;

import redis.clients.jedis.HostAndPort;
import redis.clients.jedis.JedisCluster;
import redis.clients.jedis.JedisPoolConfig;

public class JedisClient {

	@Test
	public void test1() {

		// 数据库链接池配置
		JedisPoolConfig config = new JedisPoolConfig();
		config.setMaxTotal(100);
		config.setMaxIdle(50);
		config.setMinIdle(20);
		config.setMaxWaitMillis(6 * 1000);
		config.setTestOnBorrow(true);

		// Redis集群的节点集合
		Set<HostAndPort> jedisClusterNodes = new HashSet<HostAndPort>();
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7001));
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7002));
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7003));
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7004));
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7005));
		jedisClusterNodes.add(new HostAndPort("10.10.5.224", 7006));

		// 节点，超时时间，最多重定向次数，链接池
		JedisCluster jedisCluster = new JedisCluster(jedisClusterNodes, 2000, 100, config);
		int num = 1000;
		String key = "testredis";
		String value = "lingfeng";

		// 存数据
		jedisCluster.set(key, value);

		// 取数据
		String resValue = jedisCluster.get(key);

		System.out.println(key + "=" + resValue);

		// 删除数据
		// jedisCluster.del(key);
		// String delValue = jedisCluster.get(key);
		// System.out.println(key + "=" + delValue);
	}
}
```


## 使用Spring注入JedisCluster

```xml
<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:p="http://www.springframework.org/schema/p"
	xmlns:aop="http://www.springframework.org/schema/aop" xmlns:mvc="http://www.springframework.org/schema/mvc"
	xsi:schemaLocation="http://www.springframework.org/schema/beans
			http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
			http://www.springframework.org/schema/context
			http://www.springframework.org/schema/context/spring-context-3.1.xsd
			http://www.springframework.org/schema/aop
			http://www.springframework.org/schema/aop/spring-aop-3.1.xsd
			http://www.springframework.org/schema/mvc
			http://www.springframework.org/schema/mvc/spring-mvc-3.1.xsd">

	<!-- Jedis链接池配置，注意：Jedis版本建议升级到最新（当前最新版为2.8.1） -->
	<bean id="jedisPoolConfig" class="redis.clients.jedis.JedisPoolConfig">
	    <!-- 连接池中最大连接数。高版本：maxTotal，低版本：maxActive -->
		<property name="maxTotal" value="100" />
		<!-- 连接池中最大空闲的连接数. -->
		<property name="maxIdle" value="20" />
		<!-- 连接池中最小空闲的连接数. -->
		<property name="minIdle" value="10" />
		<property name="blockWhenExhausted" value="true" />
		<!-- 当连接池资源耗尽时，调用者最大阻塞的时间，超时将跑出异常。单位，毫秒数;默认为-1.表示永不超时。高版本：maxWaitMillis，低版本：maxWait -->
		<property name="maxWaitMillis" value="3000" />
		<!-- testOnBorrow:向调用者输出“链接”资源时，是否检测是有有效，如果无效则从连接池中移除，并尝试获取继续获取。默认为false。建议保持默认值. -->
		<property name="testOnBorrow" value="false" />
		<!-- testOnReturn:向连接池“归还”链接时，是否检测“链接”对象的有效性。默认为false。建议保持默认值.-->
		<property name="testOnReturn" value="false" />
		<!-- testWhileIdle:向调用者输出“链接”对象时，是否检测它的空闲超时；默认为false。如果“链接”空闲超时，将会被移除。建议保持默认值. -->
		<property name="testWhileIdle" value="true" />
		<!-- 连接空闲的最小时间，达到此值后空闲连接将可能会被移除。负值(-1)表示不移除. -->
		<property name="minEvictableIdleTimeMillis" value="60000" />
		 <!-- “空闲链接”检测线程，检测的周期，毫秒数。如果为负值，表示不运行“检测线程”。默认为-1. -->
		<property name="timeBetweenEvictionRunsMillis" value="30000" />
		<!-- 对于“空闲链接”检测线程而言，每次检测的链接资源的个数。默认为3 -->
		<property name="numTestsPerEvictionRun" value="3" />
		<!-- whenExhaustedAction:当“连接池”中active数量达到阀值时，即“链接”资源耗尽时，连接池需要采取的手段, 默认为1(0:抛出异常。1:阻塞，直到有可用链接资源。2:强制创建新的链接资源) -->
	</bean>

	<!-- JedisCluster -->
	<bean id="jedisCluster" class="redis.clients.jedis.JedisCluster">
		<constructor-arg index="0">
			<set>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7001" type="int" />
				</bean>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7002" type="int" />
				</bean>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7003" type="int" />
				</bean>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7004" type="int" />
				</bean>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7005" type="int" />
				</bean>
				<bean class="redis.clients.jedis.HostAndPort">
					<constructor-arg index="0" value="10.10.5.224" />
					<constructor-arg index="1" value="7006" type="int" />
				</bean>
			</set>
		</constructor-arg>
		<constructor-arg index="1" value="2000" type="int"></constructor-arg>
		<constructor-arg index="2" value="100" type="int"></constructor-arg>
		<constructor-arg index="3" ref="jedisPoolConfig"></constructor-arg>
	</bean>

</beans>
```


```Java
package me.lingfeng.test;

import java.util.HashSet;
import java.util.List;
import java.util.Set;

import org.junit.Test;
import org.springframework.context.support.ClassPathXmlApplicationContext;
import org.springframework.data.redis.core.RedisTemplate;

import redis.clients.jedis.HostAndPort;
import redis.clients.jedis.JedisCluster;
import redis.clients.jedis.JedisPoolConfig;

public class JedisClient {

	@Test
	public void tset2(){
		ClassPathXmlApplicationContext applicationContext = new ClassPathXmlApplicationContext(
				"classpath*:/spring/applicationContext-redis.xml");

		// 获取Spring提供的RedisTemplate类此类封装了Jedis，简化操作
		JedisCluster jedisCluster = applicationContext.getBean("jedisCluster",JedisCluster.class);

		jedisCluster.set("test2", "lingfeng");

		System.out.println(jedisCluster.get("test2"));
	}
}

```

## 使用Spring data redis集成

### 简单集成


### 集群集成


 spring data redis
http://projects.spring.io/spring-data-redis/
