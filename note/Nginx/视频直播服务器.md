

编译参数
```bash
--prefix=/home/live/liveplatform/nginx-1.9 \
--with-http_stub_status_module \
--with-http_ssl_module \
--with-http_gzip_static_module \
--with-http_realip_module \
--with-http_mp4_module \
--with-http_flv_module \
--with-pcre=/home/live/liveplatform/pcre-8.39 \
--with-zlib=/home/live/liveplatform/zlib-1.2.8 \
--with-openssl=/home/live/liveplatform/package/openssl-1.0.0t \
--add-module=/home/live/liveplatform/nginx-rtmp-module-1.1.10

```


配置文件

```nginx

# 配置系统用户
user  live;
worker_processes  1;

#error_log  logs/error.log;
#error_log  logs/error.log  notice;
#error_log  logs/error.log  info;

#pid        logs/nginx.pid;


events {
    worker_connections  1024;
}

# rtmp服务
rtmp {  
    server {  

        # rtmp服务监听端口
        listen 1935;  
        chunk_size 4096;

        #log_format new '$remote_addr';
        #access_log logs/rtmp_access.log new;
        #access_log logs/rtmp_access.log;
        #access_log off;

        # rtmp协议推流应用
        application myapp {  
            live on;  
            record off;
            recorder rec1 {
                record all;
                record_path /tmp/rec;
                record_suffix -%d-%b-%y-%H-%M-%S.flv;
                record_unique on;
                exec_record_done yamdi -i $path -o /home/live/liveplatform/nginx-1.9/aout.flv;
                exec_record_done echo $path >>/home/live/liveplatform/nginx-1.9/logs/record.log;
            }               

        }

        # video on demand
        application vod {
            play /tmp/rec;
        }

        application vod_http {
            play http://112.64.196.234/vod;
        }

        # hls推流应用
        application hls {  
            live on;  
            hls on;
            # 每个ts文件的视频时长
            hls_fragment 1s;
            # hls临时文件地址
            hls_path /tmp/hls;
            # 视频永久存储
            recorder rec1 {
                record all;
                #record_max_size 64K;
                record_path /tmp/rec;
                record_suffix -%d-%b-%y-%H-%M-%S.flv;
                record_unique on;
                # 存储完成之后执行的命令
                exec_record_done yamdi -i $path -o /home/live/liveplatform/nginx-1.9/aout.flv;
                exec_record_done echo $path >>/home/live/liveplatform/nginx-1.9/logs/record.log;
            }

            #recorder chunked {
                #record all;
                #record_max_size 6200K;
                #record_interval 10s;
                #record_suffix -%Y-%m-%d-%H_%M_%S.flv;
                #record_path /tmp/rec/Chunked;
            #}
        }  
    }  
}  

http {
    include       mime.types;
    default_type  application/octet-stream;

    #log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
    #                  '$status $body_bytes_sent "$http_referer" '
    #                  '"$http_user_agent" "$http_x_forwarded_for"';

    #access_log  logs/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    #keepalive_timeout  0;
    keepalive_timeout  65;

    #gzip  on;

    server {
        listen       80;
        server_name  112.64.196.234;

        #charset koi8-r;

        #access_log  logs/host.access.log  main;

        location / {
            root   html;
            index  index.html index.htm;
        }

        # 配置视频播放
        location ~ \.flv {
            flv;
        }

        #location ~ \.mp4 {
        #    mp4;
        #}

        # 配置rtmp监控
        location /stat {  
            rtmp_stat all;  
            rtmp_stat_stylesheet stat.xsl;  
        }  

        location /stat.xsl {  
            root /home/live/liveplatform/nginx-rtmp-module-1.1.10/;  
        }  

        location /control {  
            rtmp_control all;  
        }  

        # 配置hls的http接收
        location /hls {  
            types {  
                application/vnd.apple.mpegurl m3u8;  
                video/mp2t ts;  
            }  
            root /tmp;  
            add_header Cache-Control no-cache;  
            expires -1;  
        }  

        #error_page  404              /404.html;

        # redirect server error pages to the static page /50x.html
        #
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }


    # another virtual host using mix of IP-, name-, and port-based configuration
    #
    #server {
    #    listen       8000;
    #    listen       somename:8080;
    #    server_name  somename  alias  another.alias;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}


    # HTTPS server
    #
    #server {
    #    listen       443 ssl;
    #    server_name  localhost;

    #    ssl_certificate      cert.pem;
    #    ssl_certificate_key  cert.key;

    #    ssl_session_cache    shared:SSL:1m;
    #    ssl_session_timeout  5m;

    #    ssl_ciphers  HIGH:!aNULL:!MD5;
    #    ssl_prefer_server_ciphers  on;

    #    location / {
    #        root   html;
    #        index  index.html index.htm;
    #    }
    #}

}
```


安装yamdi
yadmi的作用是为flv文件添加关键帧，才能实现拖动播放

```
#下载yadmi
wget http://sourceforge.net/projects/yamdi/files/yamdi/1.4/yamdi-1.4.tar.gz/download
#安装yadmi
tar xzvf yamdi-1.4.tar.gz
cd yamdi-1.4
make && make install
使用方法：yamdi -i input.flv -o out.flv
给input.flv文件 添加关键帧，输出为out.flv文件
```


hls播放

```html

```


flash播放

```html

```
